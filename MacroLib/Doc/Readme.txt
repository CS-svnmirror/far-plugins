Far Macro Library
-----------------

Плагин предназначен для управления макросами FAR, хранимыми в текстовом формате.

Плагин использует собственный формат файла - FML (Far Macro Library). В одном
FML файле может быть записано произвольное количество макросов. При запуске
плагин ищет все FML файлы в заданном каталоге (по умолчанию - подкаталог Macros
в каталоге плагина). Если макросу назначена горячая клавиша, то он будет 
вызван автоматически при ее нажатии. Макросы, которым не назначена горячая
клавиша, можно вызывать через меню плагина. Если на одну горячую клавишу
назначено несколько макросов, то при ее нажатии будет предложено выбрать один
из них.

Данный плагин можно использовать совместно с обычными макросами, хранящимися
в реестре. Плагин обладает приоритетом, при обработке событий клавиатуры и мыши,
если на одну клавишу назначены макросы в FML файле и реестре, то сработают
только макросы из FML файла (если только они не "пропускают" событие для 
дальнейшей обработки FAR - см. параметр макроса EatOnRun).


Ограничения:

 Поскольку плагин запускает макросы самостоятельно, а не через стандартный 
 механизм запуска клавиатурных макросов FAR, то имеется ряд ограничений
 (возможно, список не полный):

 1. Не работают макрокоманды, возвращающие код запускающей клавиши: 
    $AKey и AKey(). Вместо них можно использовать макроподстановку #AKey

 2. Макросы из FML файлов не могут быть вызваны через макрофункцию Eval.


-----------------------------------------------------------------------------

Формат макро файла

Макрофайл - текстовый файл с расширением FML. Каждая конструкция макрофайла 
начинается с соответствующего ключевого слова. Все ключевые слова и 
идентификаторы, описываемые в марофайлах - регистронезависимы.

Комментарии

 Поддерживаются однострочные и многострочные комментарии. Однострочные 
 комментарии начинаются с ;; или //. Многострочные комментарии 
 ограничиваются /* ... */, вложенные многострочные комментарии не 
 поддерживаются. Все типы комментариев могут использоваться в любом месте 
 макрофайла, в том числе - в  тексте макропоследовательности.


Константы

 Описание константы начинается с ключевого слова Const:

  const dlgFindFile = "{8C9EAD29-910F-4b24-A669-EDAFBA6ED964}"
  const EdtFind = 0x444E4645
  const faReadOnly = 1

 Строковые литералы могут заключаться в одинарные иди двойные кавычки.
 Для использования той-же кавычки внутри литерала она удваивается.

 Константы можно использовать при задании макрообластей (см. далее),
 а также в тексте макропоследовательности в формате #%ИмяКонстанты,
 подробнее в описании препроцессора. Зона видимости констант: с момента
 описания до конца разбора макрофайла. Повторное описание - недопустимо.


Включения (Include)

 К макрофайлу можно подключить другой файл с помощью оператора Include.

 Если оператор Include встречается _не_ в тексте маропоследовательности,
 то включаемый файл должен иметь синтаксис макрофайла. Расширение включаемого
 файла может быть любым, но рекомендуется использовать расширение .FMI
 (Far Macro Include). Не рекомендуется давать включаемому файлу расширение FML,
 так как в этом случае он может начать обрабатываться как самостоятельный
 макрофайл, что, обычно, нежелательно. Путь к включаемому файлу задается
 относительно включающего файла. Допустимо использование переменных окружения.
 Include могут быть вложенными, глубина вложенности - не ограничена. Рекурсия,
 естественно, недопустима.

 Примеры:

  include "Consts.fmi"
  include "%FarHome%\Macros\Library.fmi"

 Также возможно подключение файлов в тексте макропоследовательности. Для этого
 используется оператор #Include. В этом случае включаемый файл должен иметь 
 синтаксис "plain-text" макро. Пример:

  Macro Descr="Select same filenames on both panels" Area="Shell" 
  {{
    #Include "Compare.macro"
  }}

 Замечание: при использовании оператора #Include в тексте макропоследовательности
 любые ошибки при проверке макроса приведут к неправильному позиционированию 
 при открытии текстового редактора. 


Макросы

 Описание макроса начинается с ключевого слова Macro. Обобщенный формат макроса:

  Macro Parameter1="StrValue" Parameter2=IntValue
  {{
    Текст макропоследовательности
  }}

Параметры (некоторые параметры имеют несколько синонимов):

 Name 
   - Имя макроса (пока - никак не используется)

 Description, Descr
   - Описание макроса

 Area, Areas
   - Макро область. Допустимо указание нескольких областей, через пробел.
     Если опущено, то макрос срабатывает во всех областях.

     Возможные значения:

     Shell, Editor, Viewer, Dialog, Menu, MainMenu, UserMenu, 
     Help, QView, Info, Tree, Disks, Search, FFolder, ACompl

     Для макрообласти Dialog дополнительно можно указать GUID диалога, 
     в формате "Dialog.GUID". GUID можно указывать непосредственно в
     строке, либо использовать ранее описанную константу. Например, 
     для диалога поиска:

     Area="Dialog.{8C9EAD29-910F-4B24-A669-EDAFBA6ED964}" 
       или
     Area="Dialog.dlgFindFile"

 Bind, Key, Keys, Hotkey, Hotkeys
   - Горячая клавиша для запуска, в формате FAR, например: "CtrlAltF12"
     Допустимо указание нескольких клавиш, через пробел. Если опущено,
     макрос может быть вызван только через меню.

 Event, Events
   - Альтернативный способ запуска макросов - по событию. В текущей версии
     поддерживается только один тип события "Open". Если это событие 
     назначено для области Shell, то макрос исполняется один раз при
     запуске FAR. Если событие назначено для областей Editor, Viewer или
     Dialog то макрос исполняется каждый раз при открытии соответствующего
     окна. Для других областей событие игнорируется.


 Condition, Cond
   - Условия срабатывания макроса. Строка условий имеет формат:
       "Условие:0 Условие:1 ..."

     Если заданы несколько условий, то макрос запустится только если выполняются
     все условия (т.е. условия объединяются по and). Возможные варианты условий:

     CmdLine:0/1   - Командная строка пуста/не пуста
     Selected:0/1  - не отмечен/отмечен блок в редакторе, программе просмотра, 
                     в строках ввода в диалогах.

     PanelType:0/1     - Текущая панель: 0 - файловая, 1 - плагинная
     PanelItem:0/1     - Текущий элемент панели: 0 - файл, 1 - папка
     PanelSelected:0/1 - нет/есть выделение на текущей панели

     PPanelType, PPanelItem, PPanelSelected - аналогично, для пассивной панели


 DisableOutput=0/1, по умолчанию 1
 SendToPlugin=0/1, по умолчанию 1
   - Режимы исполнения макроса (см. документацию FAR)

 RunOnRelease=0/1, по умолчанию 0
   - Если = 1, то макрос будет исполняться не при нажатии, а при отпускании
     горячей клавиши или кнопки мыши. Полезно при назначении макросов на 
     однократное нажатие префиксных клавиш Ctrl/Alt/Shift.

 EatOnRun=0/1, по умолчанию 1
   - Если = 1 то событие вызвавшее макрос (нажатие горячей клавиши или событие
     мыши) будет удалено из очереди сообщений и не попадет в FAR.

Макропоследовательность

 Перед тем как быть переданной на проверку или исполнение FAR'у текст макро-
 последовательности проходит предварительную обработку (препроцессинг). 
 На этом этапе:

   - Удаляются все комментарии.
   - Обрабатываются операторы #Include
   - Макроконстанты #%Name раскрываются до значений
   - Обрабатывается макроподстановка #AKey

 Макроподстановка #AKey раскрывается в цифровой код клавиши, вызвавшей макрос,
 т.е. она аналогична вызову функции AKey(0). Для того чтобы получить имя
 клавиши, используйте Key(#AKey), а вместо $AKey - Eval(Key(#AKey)).

 Препроцессор не делает полноценный разбор макроса (этим занимается сам FAR).
 Он лишь выделяет из текста макроса свои конструкции (комментарии и операторы,
 начинающиеся с символа "#")
